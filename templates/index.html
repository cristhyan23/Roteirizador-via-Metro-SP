<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roteiro de Viagem - Transporte Público</title>
    <link rel="stylesheet" href="static/css/styles.css">
    <script src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}" async defer></script>
    <style>
        #map {
            width: 600px; 
            height: 400px;
        }
    </style>
</head>
<body>
    <div class="container">
        <form action="/gerar_roteiro" method="POST">
            <div class="form-field">
                <label for="endOrigem">Endereço Origem</label>
                <input type="text" name="endOrigem" id="endOrigem" placeholder="Endereço Origem" required />
            </div>
            <div class="form-field">
                <label for="endDestino">Endereço Destino</label>
                <input type="text" name="endDestino" id="endDestino" placeholder="Endereço Destino" required />
            </div>
            <div>
                <button type="submit" class="solid" id="busca-roteiro">Buscar Roteiro</button>
            </div>
        </form>

        <div class="content">
            
            <div id="roteiro">
                <h3>Roteiro Gerado:</h3>
                {% if roteiro %}
                    <div>{{ roteiro | safe }}</div>
                {% endif %}
                
            </div>
            <div id="map"></div>
            <script>
                function initMap() {
                    // Cria um mapa e define a localização inicial
                    var map = new google.maps.Map(document.getElementById('map'), {
                        center: { lat: -23.550520, lng: -46.633308 }, // Centro de São Paulo
                        zoom: 12
                    });
        
                    // Carrega os dados da rota a partir do arquivo JSON
                    fetch('dados.json')
                        .then(response => response.json())
                        .then(data => {
                            // Cria uma instância do DirectionsService e do DirectionsRenderer
                            var directionsService = new google.maps.DirectionsService();
                            var directionsRenderer = new google.maps.DirectionsRenderer();
                            directionsRenderer.setMap(map);
        
                            // Constrói a solicitação de rota
                            var request = {
                                origin: new google.maps.LatLng(data.start_location.lat, data.start_location.lng),
                                destination: new google.maps.LatLng(data.end_location.lat, data.end_location.lng),
                                waypoints: data.waypoints.map(function(point) {
                                    return {
                                        location: new google.maps.LatLng(point.lat, point.lng),
                                        stopover: false
                                    };
                                }),
                                travelMode: 'TRANSIT' // ou 'WALKING' se for uma rota a pé
                            };
        
                            // Calcula e exibe a rota
                            directionsService.route(request, function(result, status) {
                                if (status === 'OK') {
                                    directionsRenderer.setDirections(result);
                                } else {
                                    console.error('Erro ao calcular a rota: ' + status);
                                }
                            });
                        })
                        .catch(error => console.error('Erro ao carregar dados JSON:', error));
                }
        
                // Inicializa o mapa quando a página carrega
                window.onload = initMap;
            </script>
        </div>
    
    </div>
 </body>
</html>
